<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
	xmlns:validation="http://www.mulesoft.org/schema/mule/validation"
	xmlns:json-logger="http://www.mulesoft.org/schema/mule/json-logger" xmlns:db="http://www.mulesoft.org/schema/mule/db" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/db http://www.mulesoft.org/schema/mule/db/current/mule-db.xsd
http://www.mulesoft.org/schema/mule/json-logger http://www.mulesoft.org/schema/mule/json-logger/current/mule-json-logger.xsd
http://www.mulesoft.org/schema/mule/validation http://www.mulesoft.org/schema/mule/validation/current/mule-validation.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd">
	<sub-flow name="insert-customer-data" doc:id="c504826a-d784-4969-ac80-429b4a6cb2bd" >
		<logger level="INFO" doc:name="console-customer-email" doc:id="b9ca9cb8-c601-4638-a528-d8ddf351ecd8" message="#[payload.email]"/>
		<db:select doc:name="Check-new-customer-email-already-exist-or-not" doc:id="d96ab87b-945c-49a3-8cbd-04a54a66194f" config-ref="Database_Config" target="checkCustomerEmail">
			<db:sql ><![CDATA[select * from customers WHERE email = :email]]></db:sql>
			<db:input-parameters ><![CDATA[#[{
	email : payload.email
}]]]></db:input-parameters>
		</db:select>
		<choice doc:name="Choice" doc:id="c9e1c7cb-a573-48a2-bdaa-7a30b94135eb" >
			<when expression="#[sizeOf(vars.checkCustomerEmail)&gt;0]">
				<logger level="INFO" doc:name="expression-block" doc:id="c9b9b806-24a7-4521-9101-bf3d2825c1f2" message="email-allready-exist"/>
				<ee:transform doc:name="customer-email-allready-exist" doc:id="c226c8a3-3a19-425f-87cc-f03d20e38f60" >
					<ee:message >
						<ee:set-payload ><![CDATA[%dw 2.0
output application/json
var existEmail = payload.email
---
{
	'success': false,
	'statusCode': 202,
	'message' : "Customer already exist with this " ++ existEmail as String ++ " email."
}]]></ee:set-payload>
					</ee:message>
				</ee:transform>
				<logger level="INFO" doc:name="customer-email-already-exist" doc:id="1850c44b-a5d2-4858-8111-07f6abac1a0a" message="Customer email has already exist"/>
			</when>
			<otherwise >
				<logger level="INFO" doc:name="default-block" doc:id="81e7ef12-9c95-462d-8881-2b25941969f3" message="insert-customer-data"/>
				<db:insert doc:name="Insert-customer-data" doc:id="844abcb2-a0d9-4f74-aa1c-251c3353d97e" config-ref="Database_Config" autoGenerateKeys="true" target="insertCustomerData">
					<db:sql ><![CDATA[insert into customers(first_name,last_name,email,phone,date_of_birth,gender,employee_type,annual_income,active,created_at) 
VALUES(:first_name,:last_name,:email,:phone,:date_of_birth,:gender,:employee_type,:annual_income,:active,:created_at)]]></db:sql>
					<db:parameter-types >
						<db:parameter-type key="active" type="OTHER" />
						<db:parameter-type key="gender" type="OTHER" />
						<db:parameter-type key="employee_type" type="OTHER" />
					</db:parameter-types>
					<db:input-parameters ><![CDATA[#[{
	first_name: payload.first_name,
	last_name: payload.last_name,
	email: payload.email,
	phone: payload.phone,
	date_of_birth: payload.date_of_birth as Date {format: "yyyy-MM-dd"},
	gender: payload.gender,
	employee_type: payload.employee_type,
	annual_income: payload.annual_income,
	active: payload.active,
	created_at: now() as Date {format: "yyyy-MM-dd"}
}]]]></db:input-parameters>
				</db:insert>
				<ee:transform doc:name="success-message" doc:id="d1009413-5651-4102-904d-1a3c9082121c" >
					<ee:message >
						<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
	"success"    : true,
	"statusCode": 201,
	'message': 'The Customer ID ' ++ vars.insertCustomerData.generatedKeys as String ++ ' has been successfully created.'
}]]></ee:set-payload>
					</ee:message>
				</ee:transform>
				<logger level="INFO" doc:name="customer-inserted" doc:id="fff62c6a-36ca-4c7c-8239-bac83446b038" message="Customer has inserted successfully"/>
			</otherwise>
		</choice>
	</sub-flow>
	<sub-flow name="update-customer-data" doc:id="a8b9f351-73f2-4d61-a22f-fd3675f73a30" >
		<validation:is-not-null doc:name="customer-id-should-not-null" doc:id="e1b9ac41-31a4-4080-a204-07324ae279c7" config-ref="Validation_Config" value="#[attributes.uriParams.'customerId']"/>
		<validation:is-number doc:name="customer Id should be number" doc:id="bb458537-658d-4616-bfd8-52d0f2c42c13" config-ref="Validation_Config" value="#[attributes.uriParams.'customerId']" minValue="1" numberType="INTEGER" message="Customer Id should be integer">
		</validation:is-number>
		<set-variable value="#[attributes.uriParams.'customerId']" doc:name="Set customer-id" doc:id="779abaa9-aa4d-4d8c-ad9d-1be05e28eebf" variableName="customerId"/>
		<db:query-single doc:name="get-customer-data-by-id" doc:id="5927e93e-5bd2-4a1a-be8b-7e16eac1dc7e" config-ref="Database_Config" target="customerDataById">
			<db:sql ><![CDATA[select * from customers where id =:customerId]]></db:sql>
			<db:input-parameters ><![CDATA[#[{
	customerId : vars.customerId
}]]]></db:input-parameters>
		</db:query-single>
		<choice doc:name="Choice" doc:id="ad273f2d-e0b0-4ee4-85a7-37e526433905" >
			<when expression="#[sizeOf(vars.customerDataById)&gt;0]">
				<logger level="INFO" doc:name="customer-update-block" doc:id="33392354-eea1-4b93-afad-338c703199e5" message="update customer block"/>
				<ee:transform doc:name="transforming-customer-data" doc:id="0f8eac8f-be8a-435e-9f8d-19fb56f70e31">
					<ee:message>
					</ee:message>
					<ee:variables >
						<ee:set-variable variableName="customerUpdateData" ><![CDATA[%dw 2.0
output application/json skipNullOn = "everywhere"
---
{
	'first_name' : payload.first_name,
	'last_name' : payload.last_name,
	'email' : payload.email,
	'phone' : payload.phone,
	'date_of_birth' : payload.date_of_birth,
	'gender' : payload.gender,
	'employee_type' : payload.employee_type,
	'annual_income' : payload.annual_income,
	'active' : payload.active
}]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
				<logger level="INFO" doc:name="console-transform-data" doc:id="b7a0a725-df45-4386-9d70-458386a236e6" message="print variable customerUpdateData is #[vars.customerUpdateData]"/>
				<ee:transform doc:name="update-customer" doc:id="76123ce3-2681-4a2a-a93e-24885b9bbf87">
					<ee:message>
					</ee:message>
					<ee:variables >
						<ee:set-variable variableName="updateCustomerQuery" ><![CDATA[%dw 2.0
output application/json
---
"UPDATE customers SET " ++ (vars.customerUpdateData mapObject {
	"Query": $$ ++ " = '" ++ $ ++ "'"
	 }
	 pluck $ joinBy "," )
	 ++ ", updated_at= '" ++ now() as String {format: "yyyy-MM-dd HH:m:s"} ++ "' WHERE id= " ++ vars.customerId]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
				<logger level="INFO" doc:name="console-payload" doc:id="ecdb49b3-c99b-452a-a706-5f3857e76333" message="print payload: #[payload]"/>
				<logger level="INFO" doc:name="console-update-query" doc:id="50744606-b980-4e19-876b-866b00b640e8" message="print customer update query:  #[vars.updateCustomerQuery]"/>
				<json-logger:logger doc:name="Logger" doc:id="2c312a90-97b5-45e1-9c93-94de591e5190" config-ref="JSON_Logger_Config" message="#[vars.updateCustomerQuery]"/>
				<db:update doc:name="Update" doc:id="779b1ece-c764-4cd7-a834-f7fdec23c6e9" config-ref="Database_Config">
					<db:sql ><![CDATA[#[vars.updateCustomerQuery]]]></db:sql>
				</db:update>
				<ee:transform doc:name="success-message" doc:id="ec7e2e09-00cb-4e09-8800-cc7a97687eb1" >
					<ee:message >
						<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
	"Success"    : true,
	"statusCode": 200,
	'message': 'The Customer ID ' ++ vars.customerId as String ++ ' has been successfully updated'
}]]></ee:set-payload>
					</ee:message>
				</ee:transform>
				<logger level="INFO" doc:name="customer-updated-successfully" doc:id="f5b5c092-310e-4bb7-b86c-513dc4207e81" message="customer updated successfully"/>
			</when>
			<otherwise >
				<ee:transform doc:name="customer-does-not-exist" doc:id="18fa633e-f7a3-48cc-98d0-fe92f0ba5584" >
					<ee:message >
						<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
	'message' : 'No record found by '++ vars.customerId as String ++ ' Customer Id.'
}]]></ee:set-payload>
					</ee:message>
				</ee:transform>
				<logger level="INFO" doc:name="customer-not-updated" doc:id="8d6fcf46-93f3-4796-9ad8-6738b1f426ed" message="customer not updated"/>
			</otherwise>
		</choice>
	</sub-flow>
	<sub-flow name="get-all-customer-data" doc:id="37eadf34-fa69-4e1a-b731-6b10be3c5a43" >
		<logger level="INFO" doc:name="get-all-customer-data-flow" doc:id="a838f06e-a513-4049-bb0e-8e8d94b14829" message="get-all-customer-data-flow"/>
		<validation:is-not-null doc:name="Limit should not empty" doc:id="ae20f160-89ec-411c-aa34-4fc038d75010" config-ref="Validation_Config" value="#[message.attributes.queryParams.limit]" message="Limit query parameter is mandatory"/>
		<validation:is-number doc:name="Limit-should-be-number" doc:id="692d14a5-a62b-4e8f-86e6-de8da5f683b1" config-ref="Validation_Config" value="#[message.attributes.queryParams.limit]" minValue="1" numberType="INTEGER" message="Limit should be integer"/>
		<logger level="INFO" doc:name="console-queryParams" doc:id="a199f391-a418-4764-80b3-daf492b00030" message="#[message.attributes.queryParams.limit]"/>
		<db:select doc:name="select-all-customer-data" doc:id="70e1e21b-d0f7-4242-af4f-30591a0673d0" config-ref="Database_Config" target="allCustomersData">
			<db:sql ><![CDATA[SELECT * from customers
ORDER BY first_name LIMIT :limit;]]></db:sql>
			<db:input-parameters ><![CDATA[#[{
	limit: message.attributes.queryParams.limit
}]]]></db:input-parameters>
		</db:select>
		<choice doc:name="Choice" doc:id="4779efb9-f194-44ef-83dd-e156433ad936" >
			<when expression="#[sizeOf(vars.allCustomersData)&gt;0]">
				<logger level="INFO" doc:name="expression-block" doc:id="73f4dd3f-cdc2-41c0-9b19-6e6e48693031" message="expression-block"/>
				<ee:transform doc:name="show-all-customers" doc:id="2fdd52ab-3ac0-42d5-8607-278693ba0a45" >
					<ee:message >
						<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
	'success' : true,
	'statusCode': 200,
	'data': vars.allCustomersData
}
]]></ee:set-payload>
					</ee:message>
				</ee:transform>
				<logger level="INFO" doc:name="get-all-customers-successfully" doc:id="cd836d67-f584-4371-82f9-798e6ab8fa3a" message="All customer get successfully"/>
			</when>
			<otherwise >
				<ee:transform doc:name="no-customer-found" doc:id="ae0a25f5-0b87-4d47-ad2a-f69b567171c2" >
					<ee:message >
						<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
	'success': false,
	'statusCode': 204,
	'message': 'No customer found'
}]]></ee:set-payload>
					</ee:message>
				</ee:transform>
				<logger level="INFO" doc:name="no-record-found" doc:id="31d0bd7d-476a-430e-a011-004919039461" message="No customer has found"/>
			</otherwise>
		</choice>
	</sub-flow>
	<sub-flow name="get-customer-by-id" doc:id="7fde2619-8d09-4065-ada2-aa89294cdfc8" >
		<logger level="INFO" doc:name="get-customer-by-id-flow" doc:id="f6ee7b75-0896-445f-84d5-62dad0216879" message="get-customer-by-id-flow"/>
		<validation:is-not-null doc:name="customer-id-should-not-null" doc:id="1026a4b0-b692-4175-9e24-3c7febd30cc5" config-ref="Validation_Config" value="#[attributes.uriParams.'customerId']" message="Customer id should not null"/>
		<validation:is-number doc:name="customer-id-should-be-number" doc:id="0702e651-185f-4f45-a8a8-305ab4c6f1e2" config-ref="Validation_Config" value="#[attributes.uriParams.'customerId']" minValue="1" numberType="INTEGER" message="Customer ID should be integer">
			<error-mapping sourceType="VALIDATION:INVALID_NUMBER" targetType="APP:CUSTOMERROR" />
		</validation:is-number>
		<db:select doc:name="select-customer-by-id" doc:id="b88a2bd9-5598-4c96-9ef4-d76eb34cc3f5" config-ref="Database_Config" target="getCustomerById">
			<db:sql ><![CDATA[select * from customers where id =:customerId]]></db:sql>
			<db:input-parameters ><![CDATA[#[{
	customerId : attributes.uriParams.'customerId'
}]]]></db:input-parameters>
		</db:select>
		<choice doc:name="Choice" doc:id="da7b81e6-ec30-40c7-bc1e-42b3d718f474" >
			<when expression="#[sizeOf(vars.getCustomerById)&gt;0]">
				<logger level="INFO" doc:name="expression-block" doc:id="013fcd64-ddfb-456c-9cc5-0d0557568977" message="expression-block"/>
				<ee:transform doc:name="show-customer-data" doc:id="00c5c44c-c5ba-435b-b9ef-8860699c2614" >
					<ee:message >
						<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
	"success": true,
	"statusCode": 200,
	"data": vars.getCustomerById
}
]]></ee:set-payload>
					</ee:message>
				</ee:transform>
				<logger level="INFO" doc:name="customer-get-by-id-successfully" doc:id="01995438-b04b-4c79-ba72-d4ee0d6c9985" message="customer get by id successfully"/>
			</when>
			<otherwise >
				<ee:transform doc:name="no-customer-found" doc:id="da695540-6b81-4482-adf3-9342b6708760" >
					<ee:message >
						<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
	'success': false,
	'statusCode': 204,
	'message': 'No customer found by ' ++ attributes.uriParams.'customerId' as String ++ ' ID.'
}]]></ee:set-payload>
					</ee:message>
				</ee:transform>
				<logger level="INFO" doc:name="no-customer-found-by-particular-id" doc:id="42a25f10-dbe9-488c-8e6f-e30e0d64cdd3" message="no customer found by this id"/>
			</otherwise>
		</choice>
	</sub-flow>
	<sub-flow name="sapi-add-customer-document" doc:id="5a2d2b2d-0529-4ece-9dc1-fcd4547a0aa7" >
		<logger level="INFO" doc:name="console-customer-document-payload" doc:id="7a5f4640-1cdf-4071-8ceb-3ad3c20439c6" message="#[payload]"/>
		<validation:is-number doc:name="customer id should be number" doc:id="8f151b89-ae79-47a4-a04c-cb9081a89ae1" config-ref="Validation_Config" value="#[payload.customer_id]" numberType="INTEGER" message="Customer ID should be number">
			<error-mapping sourceType="VALIDATION:INVALID_NUMBER" targetType="APP:CUSTOMERROR" />
		</validation:is-number>
		<validation:is-not-null doc:name="customer id should not null" doc:id="8f1c3baa-0981-4c2e-b861-d5494c33422d" config-ref="Validation_Config" value="#[payload.customer_id]" message="Customer ID should not null"/>
		<set-variable value="#[payload.customer_id]" doc:name="Set customer-id-in-variable" doc:id="3332dbbe-3130-47aa-970f-81cb6b66b3ae" variableName="customerId"/>
		<db:select doc:name="check-customer-exist-in-primay-table-or-not" doc:id="184dc76d-e215-4f25-ba6d-a0b573ea4aa7" config-ref="Database_Config" target="checkCustomerExist">
			<db:sql ><![CDATA[select * from customers where id = :customerId]]></db:sql>
			<db:input-parameters ><![CDATA[#[{
	customerId : vars.customerId
}]]]></db:input-parameters>
		</db:select>
		<choice doc:name="Choice" doc:id="659609da-26c0-41b9-83c5-8c91280c2569" >
			<when expression="#[sizeOf(vars.checkCustomerExist)&gt;0]">
				<logger level="INFO" doc:name="customer-exist-in-primay-table" doc:id="bc7de0bf-5f03-4dcb-a02e-92c477c75584" message="customer-exist-in-primay-table"/>
				<logger level="INFO" doc:name="Logger" doc:id="79e2c8da-2218-4531-a760-f92727b60376" message="testtttttttttt #[payload.doc_status]"/>
				<db:insert doc:name="add-customer-document-data" doc:id="51f259a0-b97d-4b9f-9d9c-7f301498455a" config-ref="Database_Config">
					<db:sql ><![CDATA[insert into customers_documents(customer_id,doc_type,image_url,doc_status) 
values(:customer_id,:doc_type,:image_url,:doc_status)
]]></db:sql>
					<db:parameter-types >
						<db:parameter-type key="doc_type" type="OTHER" />
						<db:parameter-type key="doc_status" type="OTHER" />
					</db:parameter-types>
					<db:input-parameters ><![CDATA[#[{
	customer_id: payload.customer_id,
	doc_type: payload.doc_type,
	image_url: payload.image_url,
	doc_status: payload.doc_status
}]]]></db:input-parameters>
				</db:insert>
				<ee:transform doc:name="success-message" doc:id="5318d4e2-79aa-4a64-8fc1-54f72d7aea63" >
					<ee:message >
						<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
	"Success"    : true,
	"statusCode": 201,
	"message" : "The Customer Document has been successfully added."
}]]></ee:set-payload>
					</ee:message>
				</ee:transform>
				<logger level="INFO" doc:name="customer-document-inserted" doc:id="76db7671-ca6c-4c97-9d65-56d3b072a39c" message="customer document inserted successfully"/>
			</when>
			<otherwise >
				<logger level="INFO" doc:name="customer-does-not-exist-in-primary-table" doc:id="e1b34d3b-d538-45a5-a2d9-9dacaa19c4ac" message="customer-does-not-exist-in-primary-table"/>
				<ee:transform doc:name="false-message" doc:id="a1a71574-fe64-439e-878f-4706e710b9eb" >
					<ee:message >
						<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
	'success': false,
	'statusCode': 204,
	'message' : 'No Customer found by ' ++ vars.customerId as String ++ ' Id.'
}]]></ee:set-payload>
					</ee:message>
				</ee:transform>
				<logger level="INFO" doc:name="customer-document-has-not-insert" doc:id="ececf5da-d822-475d-a20f-baba62ee108b" message="customer document has not insert"/>
			</otherwise>
		</choice>
	</sub-flow>
	<sub-flow name="sapi-customer-doc-by-id" doc:id="d68cc106-24cf-4758-ae86-72f0e0de0652" >
		<logger level="INFO" doc:name="enter-get-customer-document-by-id-flow" doc:id="4cab76e4-e72b-4d11-8cd3-3ff05fc1bd64" message="get-customer-document-by-id-flow"/>
		<validation:is-not-null doc:name="customer-id-should-not-null" doc:id="b92bad50-b5aa-4f95-b8f2-f32d9a50746e" config-ref="Validation_Config" value="#[attributes.uriParams.'customerID']" message="Customer ID should not null"/>
		<validation:is-number doc:name="Is number" doc:id="5c32507f-4bb9-42f5-95dd-b2e511e31ea8" config-ref="Validation_Config" value="#[attributes.uriParams.'customerID']" minValue="1" numberType="INTEGER" message="Customer id should be integer.">
		</validation:is-number>
		<set-variable value="#[attributes.uriParams.'customerID']" doc:name="store-customer-id-in-variable" doc:id="6cabdc99-af3b-4e51-b4ce-04fc82bb4e64" variableName="customerID"/>
		<db:select doc:name="get-customer-document-data-by-id" doc:id="e59385bb-9968-4a88-82f9-904cd009f56d" config-ref="Database_Config" target="custDocById">
			<db:sql ><![CDATA[select * from customers_documents where customer_id = :customerId]]></db:sql>
			<db:input-parameters ><![CDATA[#[{
	customerId: vars.customerID
}]]]></db:input-parameters>
		</db:select>
		<choice doc:name="Choice" doc:id="041799aa-5a91-4048-937a-1466347c503a" >
			<when expression="#[sizeOf(vars.custDocById)&gt;0]">
				<logger level="INFO" doc:name="expression-block" doc:id="72c702d1-8d9f-4503-98c5-af0fb644ae1e" message="expression-block"/>
				<ee:transform doc:name="show-customer-document-data" doc:id="46393b6b-0e6c-4e12-9431-903b923ed6eb" >
					<ee:message >
						<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
	'success': true,
	'status': 201,
	'data': vars.custDocById
}
]]></ee:set-payload>
					</ee:message>
				</ee:transform>
				<logger level="INFO" doc:name="customer document get successfully" doc:id="cceed989-6566-493c-9d10-682017e0fb2c" message="customer document get successfully"/>
			</when>
			<otherwise >
				<logger level="INFO" doc:name="default-block" doc:id="abecfd02-4919-483d-8160-49cbd24e22db" message="default-block"/>
				<ee:transform doc:name="no-customer-document-exist" doc:id="2f9ced70-1022-4978-9283-dfdcdaf60122" >
					<ee:message >
						<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
	'success': false,
	'statusCode': 204,
	'message': "No customer document found by " ++ vars.customerID as String ++ "Customer Id."
}]]></ee:set-payload>
					</ee:message>
				</ee:transform>
				<logger level="INFO" doc:name="Fail to get the customer document" doc:id="243df34d-877e-46f8-aadd-2678b875343a" message="Fail to get the customer document"/>
			</otherwise>
		</choice>
	</sub-flow>
	<sub-flow name="add-customer-wallet" doc:id="74c8ba36-9dd3-4067-901e-59424096f414" >
		<logger level="INFO" doc:name="check wallet payload" doc:id="838b3c82-d244-4955-83c8-168fb6610542" message="wallet payload : #[payload]" />
		<ee:transform doc:name="transaction-type" doc:id="dcf5a4bf-dea3-42ff-9c08-8547d7db3ab1" >
			<ee:message >
			</ee:message>
			<ee:variables >
				<ee:set-variable variableName="transactionType" ><![CDATA[%dw 2.0
output application/java
---

message.attributes.queryParams.wallet_type as String default payload.wallet_type]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
		<validation:is-not-null doc:name="customer-id-should-not-null" doc:id="e93e56f8-8f2a-4006-a236-4897f5b27369" config-ref="Validation_Config" value="#[payload.customer_id]" message="Customer Id should not null"/>
		<validation:is-number numberType="INTEGER" doc:name="customer-id-should-be-number" doc:id="ed26a1a2-aa36-4e74-b659-e12e57ddf20f" config-ref="Validation_Config" value="#[payload.customer_id]" message="Customer Id should be number"/>
		<ee:transform doc:name="Original-payload" doc:id="779a6bba-8500-4bae-8966-6387c99f948b" >
			<ee:message >
			</ee:message>
			<ee:variables >
				<ee:set-variable variableName="walletData" ><![CDATA[%dw 2.0
output application/json
---
payload


	]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
		<db:select doc:name="check-customer-exist-or-not" doc:id="261102b7-d110-439d-b5d9-700c3580a770" config-ref="Database_Config" target="checkCustomerExist">
			<db:sql ><![CDATA[select * from customers where id = :customerId]]></db:sql>
			<db:input-parameters ><![CDATA[#[{
	customerId: vars.walletData.customer_id
}]]]></db:input-parameters>
		</db:select>
		<choice doc:name="Choice" doc:id="724f12e4-cded-4d33-b38e-ae2029f801f4" >
			<when expression="#[sizeOf(vars.checkCustomerExist)&gt;0]" >
				<logger level="INFO" doc:name="customer-exist" doc:id="9555393a-94a6-4b1d-a20c-9a7665b98f4b" message="customer is active"/>
				<db:select doc:name="check-customer-wallet-amount" doc:id="3ebd8b6e-34e0-460d-bfd1-ffa11afce4dc" config-ref="Database_Config" target="checkCustomerWallet" >
					<db:sql ><![CDATA[select customer_id,wallet from customers_wallet where customer_id = :customerId]]></db:sql>
					<db:input-parameters ><![CDATA[#[{
	customerId: vars.walletData.customer_id
}]]]></db:input-parameters>
				</db:select>
				<logger level="INFO" doc:name="amount-exist-in-wallet" doc:id="1b22ba63-418c-49d8-808e-194b1700b0e8" message="customer has sufficient amount in wallet"/>
				<choice doc:name="Choice" doc:id="ee0621bb-0003-43ba-b661-14e755daf522" >
					<when expression="#[sizeOf(vars.checkCustomerWallet)&gt;0]" >
						<logger level="INFO" doc:name="update-amount-in-customer-wallet" doc:id="f3a9c26b-5d35-4a04-835e-9bbaa74e5908" message="update amount in customer wallet" />
						<ee:transform doc:name="plus-two-amount" doc:id="8db3f729-a03b-4e16-ae70-6a8c903a7c25" >
							<ee:message >
								<ee:set-payload ><![CDATA[%dw 2.0
output application/java
---
{
	
}]]></ee:set-payload>
							</ee:message>
							<ee:variables >
								<ee:set-variable variableName="totalWalletAmount" ><![CDATA[%dw 2.0
output application/json

---
if(vars.walletData.wallet_type=="credit")
vars.walletData.amount + vars.checkCustomerWallet.wallet[0] as Number
else
vars.checkCustomerWallet.wallet[0] as Number - vars.walletData.amount 

]]></ee:set-variable>
							</ee:variables>
						</ee:transform>
						<logger level="INFO" doc:name="total-amount" doc:id="6c2b00a0-6bee-4010-8442-0bbc50395912" message="total amount #[vars.totalWalletAmount]" />
						<db:update doc:name="Update-amount-customer-wallet" doc:id="257f0a68-6d65-4b9c-9652-be9d86ac1d36" config-ref="Database_Config" >
							<db:sql ><![CDATA[update customers_wallet set wallet = :wallet where customer_id = :customerId]]></db:sql>
							<db:input-parameters ><![CDATA[#[{
	customerId: vars.walletData.customer_id,
	wallet: vars.totalWalletAmount
}]]]></db:input-parameters>
						</db:update>
						<db:insert doc:name="add-entry-wallet-transaction" doc:id="58e0a16b-0f60-4d20-b0cc-2f74115d327b" config-ref="Database_Config" >
							<db:sql ><![CDATA[insert into wallet_transaction(customer_id,types,amount) values(:customerId,:types,:amount)]]></db:sql>
							<db:parameter-types >
								<db:parameter-type key="types" type="OTHER" />
							</db:parameter-types>
							<db:input-parameters ><![CDATA[#[{
	customerId: vars.walletData.customer_id,
	types: vars.transactionType,
	amount: vars.walletData.amount
}]]]></db:input-parameters>
						</db:insert>
						<ee:transform doc:name="success-message" doc:id="474f2972-d44f-41a5-91e6-5ac15d2b4f84" >
							<ee:message >
								<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
if(vars.walletData.wallet_type=="credit")
"The amount has been successfully credit in your wallet."
else
"The amount has been successfully debit from your wallet."]]></ee:set-payload>
							</ee:message>
						</ee:transform>
						<logger level="INFO" doc:name="amount-has-been-updated-in-wallet" doc:id="3b4a2ead-a5c6-4156-917c-5c0a0583613b" message="amount-has-been-updated-in-wallet"/>
					</when>
					<otherwise >
						<logger level="INFO" doc:name="first-time-insert-amount-wallet" doc:id="b96d91bb-5c7f-4ce6-af9c-d5d3d69aabbd" message="insert the wallet" />
						<db:insert doc:name="Insert amount in customer wallet" doc:id="24f4778c-6319-457b-8a61-228ab9543f17" config-ref="Database_Config" autoGenerateKeys="true" target="insertWalletData" >
							<db:sql ><![CDATA[insert into customers_wallet(customer_id,wallet) values(:customerId,:wallet)]]></db:sql>
							<db:input-parameters ><![CDATA[#[{
	customerId: vars.walletData.customer_id,
	wallet: vars.walletData.amount
}]]]></db:input-parameters>
						</db:insert>
						<logger level="INFO" doc:name="amount-inserted-in-wallet" doc:id="f45899cb-d2d5-4460-a078-c7156da06362" message="amount has been inserted in wallet table"/>
						<db:insert doc:name="add-entry-wallet-transaction" doc:id="7645ffaf-a316-4559-ba4d-d0c8aeeb99d1" config-ref="Database_Config" >
							<db:sql ><![CDATA[insert into wallet_transaction(customer_id,types,amount) values(:customerId,:types,:amount)]]></db:sql>
							<db:parameter-types >
								<db:parameter-type key="types" type="OTHER" />
							</db:parameter-types>
							<db:input-parameters ><![CDATA[#[{
	customerId: vars.walletData.customer_id,
	types: vars.transactionType,
	amount: vars.walletData.amount
}]]]></db:input-parameters>
						</db:insert>
						<logger level="INFO" doc:name="transaction inserted" doc:id="45ef6691-30d0-4df6-902f-02a8991f7522" message="transaction entry inserted in table"/>
						<ee:transform doc:name="success-message" doc:id="7bf0e06d-ab50-4886-835b-47a388cd6181" >
							<ee:message >
								<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
	'success': true,
	'statusCode': 201,
	'message': 'The Customer wallet has been added successfully.'
}]]></ee:set-payload>
							</ee:message>
						</ee:transform>
						<logger level="INFO" doc:name="amount-has-been-inserted-in-wallet" doc:id="535aee4c-a8f5-4995-ba0d-5bd0a678fb6f" message="Amount has been inserted in wallet"/>
					</otherwise>
				</choice>
			</when>
			<otherwise >
				<ee:transform doc:name="customer-does-not-exist" doc:id="49e0336e-2354-427d-bdf9-0928107a2271" >
					<ee:message >
						<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
	'message': 'Customer does not exist.'
}]]></ee:set-payload>
					</ee:message>
				</ee:transform>
			</otherwise>
		</choice>
	</sub-flow>
	<sub-flow name="get-stock-symbol-by-customer" doc:id="b5409c7a-4074-4283-a6be-186e315f8a5c" >
		<logger level="INFO" doc:name="Logger" doc:id="f3266a04-1d8e-4db1-8591-42e1d2aab323" message="#[attributes.uriParams.'stock-symbol']"/>
		<validation:is-not-null doc:name="stock-symbol-should-not-null" doc:id="f64e473d-7375-4bad-9f97-9b01c95afefb" config-ref="Validation_Config" value="#[attributes.uriParams.'stock-symbol']" message="Stock symbol should not empty."/>
		<validation:is-number numberType="INTEGER" doc:name="customer-id-should-be-number" doc:id="35fc7c3a-49dd-4f09-9e84-8a516adfc609" config-ref="Validation_Config" value="#[attributes.uriParams.'customer_id']" minValue="1" message="Customer Id should be integer"/>
		<db:select doc:name="checkCustomerExist" doc:id="bd8125e6-4203-4b42-aeeb-1448f5dac1a1" config-ref="Database_Config" target="checkCustomerExist">
			<db:sql ><![CDATA[select * from customers where id =:customerId]]></db:sql>
			<db:input-parameters ><![CDATA[#[{
	customerId: attributes.uriParams.'customer_id'
}]]]></db:input-parameters>
		</db:select>
		<choice doc:name="Choice" doc:id="8d5b96ce-d801-4bca-b885-2a0406199e42" >
			<when expression="#[sizeOf(vars.checkCustomerExist)&gt;0]">
				<db:select doc:name="Get-stock" doc:id="72ab0517-6c13-47ea-9311-71bf3b9b8672" config-ref="Database_Config" target="customerStockData">
					<db:sql ><![CDATA[select * from customers_portfolio where stock_symbol = :symbol AND customer_id= :customerId]]></db:sql>
					<db:input-parameters ><![CDATA[#[{
	symbol: attributes.uriParams.'stock-symbol',
	customerId: attributes.uriParams.'customer_id'
}]]]></db:input-parameters>
				</db:select>
				<choice doc:name="Choice" doc:id="cd9191b8-441c-41d0-9da6-7367bd24da8f" >
					<when expression="#[sizeOf(vars.customerStockData)&gt;0]">
						<ee:transform doc:name="show-stock-data" doc:id="04aad8ce-089f-4a35-a013-66e47af0a984" >
							<ee:message >
								<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
	'success': true,
	'statusCode': 200,
	'message': vars.customerStockData
}
]]></ee:set-payload>
							</ee:message>
						</ee:transform>
						<logger level="INFO" doc:name="stock-data-get-successfully" doc:id="ba6be8e9-ac05-41ee-ab13-c59ed4013b24" message="stock data get successfully"/>
					</when>
					<otherwise >
						<ee:transform doc:name="no-stock-data-found" doc:id="de8085e8-b86e-4a8f-8c1a-53892797bdfe" >
							<ee:message >
								<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
	'success': false,
	'statusCode': 204,
	'message' : 'No stock found by ' ++ attributes.uriParams.'stock-symbol' as String ++ ' symbol.'
}]]></ee:set-payload>
							</ee:message>
						</ee:transform>
						<logger level="INFO" doc:name="no-stock-found " doc:id="6596a4d6-4d34-4939-8621-566662c878fc" message="No stock found "/>
					</otherwise>
				</choice>
			</when>
			<otherwise >
				<ee:transform doc:name="customer-does-not-exist" doc:id="5db6e7bf-1bc2-45b5-be03-f910fdc87bcb" >
					<ee:message >
						<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
	'message': 'Customer does not exist.'
}]]></ee:set-payload>
					</ee:message>
				</ee:transform>
			</otherwise>
		</choice>
	</sub-flow>
	<sub-flow name="get-customer-wallet-amount" doc:id="eaae686b-0bda-4250-96e8-a24dc7d5a621" >
		<logger level="INFO" doc:name="get-customer-wallet-amount-flow" doc:id="4e501fee-778c-492d-b195-d46ab1e0f7d2" message="get-customer-wallet-amount-flow"/>
		<set-variable value="#[message.attributes.uriParams.'customer_id']" doc:name="Set customer-id" doc:id="3cd88617-5bb1-442d-a82e-b7a7461a0d88" variableName="customerId"/>
		<logger level="INFO" doc:name="console-customer-id" doc:id="5e5799ca-f3b5-46d8-a460-49681e46f2fb" message="value of customer-id is:  #[vars.customerId]"/>
		<db:select doc:name="get-customer-amount-from-wallet" doc:id="adfe5d76-1436-4553-8f72-edea3f59db8c" config-ref="Database_Config" target="walletAmount" queryTimeout="50000">
			<db:sql ><![CDATA[select * from customers_wallet where customer_id = :customerId]]></db:sql>
			<db:input-parameters ><![CDATA[#[{
	customerId: vars.customerId
}]]]></db:input-parameters>
		</db:select>
		<logger level="INFO" doc:name="console-customer-wallet" doc:id="08e0d9d6-1ec5-4b1f-ac7d-0d4ecaef39b6" message="output of customer wallet: #[vars.walletAmount]"/>
		<choice doc:name="Choice" doc:id="7508009e-c4ab-4a4d-9a21-41fb831d35cb" >
			<when expression="#[sizeOf(vars.walletAmount)&gt;0]">
				<logger level="INFO" doc:name="wallet-amount-exist" doc:id="27628364-ee9c-43ed-8565-6241db6d300c" message="wallet-amount-exist"/>
				<ee:transform doc:name="show-customer-wallet-amount" doc:id="96e4c5d6-dfcf-42b6-a7fe-c36dfcec74ec" >
					<ee:message >
						<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
	'success': 'true',
	'statusCode': 200,
	'data': vars.walletAmount
}
]]></ee:set-payload>
					</ee:message>
				</ee:transform>
				<logger level="INFO" doc:name="get-customer-wallet-successfully" doc:id="a926146c-c3c5-4e0c-a12e-5f571d3c60aa" message="customer wallet get successfully"/>
			</when>
			<otherwise >
				<logger level="INFO" doc:name="no-amount-wallet" doc:id="b49b1008-64a6-4ba3-9892-ad1ab056167f" message="no-amount-wallet"/>
				<ee:transform doc:name="message" doc:id="3b1cffeb-99eb-442f-89e3-44c8edbabcb6" >
					<ee:message >
						<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
	'success': false,
	'statusCode': 204,
	'message': 'No sufficient amount found in your wallet'
}]]></ee:set-payload>
					</ee:message>
				</ee:transform>
				<logger level="INFO" doc:name="wallet-has-no-amount" doc:id="6e5bbff5-4f03-455a-bf12-8d4eff3b0679" message="Wallet has no amount"/>
			</otherwise>
		</choice>
	</sub-flow>
	<sub-flow name="add-stock-customer-portfolio" doc:id="080fe5ad-f413-47a1-9398-29dcf9b42fe2" >
		<logger level="INFO" doc:name="console-payload" doc:id="17f33eba-1e5a-4cd5-bfdc-135baaf3224c" message="payload of stock customer portfolio: #[payload]"/>
		<set-variable value="#[payload.stock_symbol]" doc:name="Set stock symbol variable" doc:id="0f689d50-2092-4e17-bc16-1918116c17c7" variableName="stockSymbol"/>
		<db:select doc:name="check-customer-exist-or-not" doc:id="4c24ecfd-fefb-4ceb-96d7-45caff8b932f" config-ref="Database_Config" target="checkCustomerExistOrNot">
			<db:sql ><![CDATA[select * from customers where id = :customerId]]></db:sql>
			<db:input-parameters ><![CDATA[#[{
	customerId : attributes.uriParams.'customer_id'
}]]]></db:input-parameters>
		</db:select>
		<choice doc:name="Choice" doc:id="6c00abe2-96ed-4d6b-88c2-e311e1b2b928" >
			<when expression="#[sizeOf(vars.checkCustomerExistOrNot)&gt;0]">
				<logger level="INFO" doc:name="customer-exist" doc:id="fb091e2e-ce72-48f4-959a-f0cd4b74776c" message="customer-exist"/>
				<db:insert doc:name="Insert stock data" doc:id="51f3bc53-19d0-4c3e-9fb8-0ed7f775d43b" config-ref="Database_Config" autoGenerateKeys="true" target="insertStockData">
					<db:sql ><![CDATA[insert into customers_portfolio(customer_id,portfolio_name,stock_symbol,quantity,buy_price,sell_price,status,buy_date,sell_date)
values(:customer_id,:portfolio_name,:stock_symbol,:quantity,:buy_price,:sell_price,:status,:buy_date,:sell_date)]]></db:sql>
					<db:parameter-types >
						<db:parameter-type key="status" type="OTHER" />
					</db:parameter-types>
					<db:input-parameters ><![CDATA[#[{
	customer_id: payload.customer_id,
	portfolio_name: payload.portfolio_name,
	stock_symbol: payload.stock_symbol,
	quantity: payload.quantity,
	buy_price: payload.buy_price as Number,
	sell_price: payload.sell_price as Number,
	status: payload.status,
	buy_date: payload.buy_date as Date {format:"yyyy-mm-dd"},
	sell_date: payload.sell_date as Date {format:"yyyy-mm-dd"}
	
}]]]></db:input-parameters>
				</db:insert>
				<ee:transform doc:name="success-message" doc:id="a6268844-d884-45c7-b8b3-8f628e7f38ed" >
					<ee:message >
					</ee:message>
					<ee:variables >
						<ee:set-variable variableName="portfolioSuccessStatus" ><![CDATA[%dw 2.0
output application/json
---
{
	'success': true,
	'statusCode': 201,
	'message': 'The ' ++ vars.stockSymbol as String ++ ' stock symbol has been successfully added.'
}]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
				<logger level="INFO" doc:name="stock-data-inserted-successfully" doc:id="f38f3549-e2c1-4d62-9f38-87318f9a23fb" message="stock data inserted successfully"/>
			</when>
			<otherwise >
				<logger level="INFO" doc:name="customer-does-not-exist" doc:id="98c2feca-2b15-45fd-962b-0688e9b5b507" message="customer-does-not-exist"/>
				<ee:transform doc:name="message" doc:id="30a9649c-333f-4a60-b2b8-23f86e981d59" >
					<ee:message >
						<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
	'success': false,
	'statusCode': 204,
	'message': 'The customer does not found by ' ++ vars.stockSymbol as String ++ ' ID.'
}]]></ee:set-payload>
					</ee:message>
				</ee:transform>
				<logger level="INFO" doc:name="stock-not-inserted-customer-portfolio" doc:id="b32a6873-d5fc-4f37-ba70-acc08b1fa29f" message="stock not inserted customer portfolio"/>
			</otherwise>
		</choice>
	</sub-flow>
	<sub-flow name="insert-stock-customer-portfolio" doc:id="51fc5954-ecf7-4fd0-8614-c6281fd64eb8" >
		<logger level="INFO" doc:name="insert-customer-stock-portfolio-flow" doc:id="4bbc6910-2d22-43b9-a539-aa0156582a63" message="insert-customer-stock-portfolio-flow"/>
		<db:select doc:name="Check-customer-exist Or not" doc:id="ccc36642-05fa-432a-aa82-0ab1f874410f" config-ref="Database_Config" target="checkCustomerExist">
			<db:sql ><![CDATA[select * from customers where id = :customerId]]></db:sql>
			<db:input-parameters ><![CDATA[#[{
	customerId : message.attributes.uriParams.customer_id
}]]]></db:input-parameters>
		</db:select>
		<choice doc:name="Choice" doc:id="aee3d192-e604-45df-a9e3-e197e28567ce" >
			<when expression="#[sizeOf(vars.checkCustomerExist)&gt;0]">
				<logger level="INFO" doc:name="before-insert" doc:id="f8545646-7090-48c6-86e9-f4c6a2197f89" message="payload: #[payload]"/>
				<db:insert doc:name="Insert-stock-customer-portfolio" doc:id="59a89a5e-0d52-4322-a926-c28ea6c4eb57" config-ref="Database_Config" autoGenerateKeys="true">
					<db:sql ><![CDATA[insert into customers_portfolio(customer_id,portfolio_name,stock_symbol,quantity,
buy_price,sell_price,status,buy_date,sell_date) values(:customer_id,:portfolio_name,
:stock_symbol,:quantity,:buy_price,:sell_price,:status,:buy_date,:sell_date)]]></db:sql>
					<db:parameter-types >
						<db:parameter-type key="status" type="OTHER"/>
					</db:parameter-types>
					<db:input-parameters ><![CDATA[#[{
	customer_id: attributes.uriParams.customer_id,
	portfolio_name: payload.portfolio_name as String default null,
	stock_symbol: payload.stock_symbol as String default null,
	quantity: attributes.queryParams.quantity,
	buy_price: attributes.queryParams.buy_price,
	sell_price: attributes.queryParams.sell_price,
	status: attributes.queryParams.status,
	buy_date: attributes.queryParams.buy_date,
	sell_date: attributes.queryParams.sell_date
}]]]></db:input-parameters>
				</db:insert>
				<logger level="INFO" doc:name="stock inserted" doc:id="4e4cb974-168a-4661-901c-f2b3e38c64e2" message="stock inserted"/>
				<ee:transform doc:name="success-message" doc:id="ed75b4fd-50b7-4f6a-863a-508590bf35a5" >
					<ee:message >
						<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
	'success': true,
	'statusCode': 201,
	'message': 'The ' ++ payload.stock_symbol as String ++ 'stock symbol has been successfully added.'
}]]></ee:set-payload>
					</ee:message>
				</ee:transform>
				<logger level="INFO" doc:name="customer-stock-inserted-successfully" doc:id="3531c9cb-11c1-454e-a506-80e826f6c070" message="Customer stock inserted successfully"/>
			</when>
			<otherwise >
				<ee:transform doc:name="customer-does-not-exist" doc:id="431302b3-c458-4a86-8ee3-e83402520c0b" >
					<ee:message >
						<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
	'success': false,
	'statusCode': 204,
	'message': 'The stock has been not inserted.'
}]]></ee:set-payload>
					</ee:message>
				</ee:transform>
				<logger level="INFO" doc:name="stock-not-inserted" doc:id="647de877-1f38-4e9f-afad-b47c5847cab6" message="stock not inserted because customer does not exist"/>
			</otherwise>
		</choice>
	</sub-flow>
	<sub-flow name="get-stock-data-by-symbol" doc:id="f5d6c05f-5825-492a-a26d-0d4a6df10adc" >
		<logger level="INFO" doc:name="get-stock-data-by-symbol-flow" doc:id="5232c4d8-a661-4a7b-9cb2-5125a03d9cb0" message="get-stock-data-by-symbol-flow"/>
		<validation:is-not-null doc:name="stock-symbol-should-not-be-empty" doc:id="a0ade11e-049e-4bff-8ca8-f17d0a865268" config-ref="Validation_Config" value="#[attributes.uriParams.symbol_name]" message="Stock symbol should not be empty"/>
		<set-variable value="#[attributes.uriParams.symbol_name]" doc:name="set-symbol-name-in-variable" doc:id="ae666949-d4f6-42c9-b5d1-1e42360becfc" variableName="stockSymbol"/>
		<logger level="INFO" doc:name="console-stock-symbol-name" doc:id="ac213716-8274-4d0f-9c3b-773b0bcc0443" message="stock symbol:  #[vars.stockSymbol]"/>
		<db:select doc:name="get-stock-data-by-symbol" doc:id="708cf9cc-1f3b-40c2-a5e1-e2f5e4a78f83" config-ref="Database_Config" target="stockData">
			<error-mapping targetType="STOCK:CUSTOMERROR" sourceType="DB:QUERY_EXECUTION"/>
			<db:sql ><![CDATA[select * from stock where stock_symbol = :stockSymbol]]></db:sql>
			<db:input-parameters ><![CDATA[#[{
	stockSymbol: vars.stockSymbol
}]]]></db:input-parameters>
		</db:select>
		<logger level="INFO" doc:name="console-stock-data" doc:id="cc390406-8e8b-4731-a873-f514433fe3be" message="stock-data:  #[vars.stockData]"/>
		<choice doc:name="Choice" doc:id="195a5466-fc86-4bee-8b3a-55bfd37f7504" >
			<when expression="#[sizeOf(vars.stockData)&gt;0]">
				<ee:transform doc:name="stock-data" doc:id="01c8b12b-147c-425f-8eae-19f26bcc088a" >
					<ee:message >
						<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
	'success': true,
	'statusCode': 200,
	'data': vars.stockData
}
]]></ee:set-payload>
					</ee:message>
				</ee:transform>
				<logger level="INFO" doc:name="stock-data-get-successfully" doc:id="2725ef63-d3e8-44e4-bbff-98ea128e6e0e" message="stock data get successfully"/>
			</when>
			<otherwise >
				<ee:transform doc:name="no-stock-data" doc:id="4557c611-38b3-4919-8629-f55c504e7df9" >
					<ee:message >
						<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
	'success': false,
	'statusCode': 204,
	'message': 'No stock found by ' ++ vars.stockSymbol as String ++ ' symbol.'
}]]></ee:set-payload>
					</ee:message>
				</ee:transform>
				<logger level="INFO" doc:name="no-stock-found" doc:id="3950e44c-866b-4ce3-8b71-bd3cdeb560a5" message="no stock found"/>
			</otherwise>
		</choice>
	</sub-flow>
</mule>
